server_names_hash_bucket_size 128;
proxy_buffering on;
proxy_connect_timeout 5;
proxy_send_timeout 60;
proxy_read_timeout 5;
proxy_cache_valid 30d;
proxy_buffer_size 16k;
proxy_buffers 4 64k;
proxy_busy_buffers_size 128k;
proxy_temp_file_write_size 128k;
proxy_temp_path /cache/temp;
proxy_cache_path /cache/gbf levels=1:2 keys_zone=cache_gbf:70m inactive=77h max_size=7g;

upstream gbf{
        server 203.104.248.7:80;
}
upstream granbluefantasy{
        server 96.17.68.104:80;
        server 96.17.68.66:80;
}
upstream mbga{
        server 23.62.226.171:80;
        server 23.62.226.184:80;
        server 23.62.226.161:80;
        server 23.62.226.210:80;
        server 23.62.226.154:80;
        server 23.62.226.193:80;
        server 23.62.226.187:80;
}
server{
        listen 80;
        server_name game.granbluefantasy.jp;
        underscores_in_headers on;
        proxy_http_version 1.1;
        location / {
                proxy_set_header Host $host;
                proxy_set_header X-real-ip $remote_addr;
                proxy_set_header X-Forwarded-For $http_x_forwarded_for;
#                proxy_set_header Accept-Encoding "";
                add_header X-CDN-Cache $upstream_cache_status;
                proxy_pass http://gbf;
        }
}

server{
        listen 80;
        server_name gbf.game.mbga.jp;
        underscores_in_headers on;
        proxy_http_version 1.1;
        location / {
                proxy_set_header Host $host;
                proxy_set_header X-real-ip $remote_addr;
                proxy_set_header X-Forwarded-For $http_x_forwarded_for;
#                proxy_set_header Accept-Encoding "";
#                set  $injected  '<script src="https://blhx.danmu9.com/blhxfy/extension.user.js"></script>';
#                sub_filter  '</head>'  '${injected}</head>';
#                sub_filter_types *;
#                sub_filter_once on;
                add_header X-CDN-Cache $upstream_cache_status;
                proxy_pass http://gbf;
        }
}

server{
        listen 80;
        server_name game-a.granbluefantasy.jp game-a1.granbluefantasy.jp game-a2.granbluefantasy.jp game-a3.granbluefantasy.jp game-a4.granbluefantasy.jp game-a5.granbluefantasy.jp;
        underscores_in_headers on;
        proxy_http_version 1.1;
        location / {
                proxy_set_header Host $host;
                proxy_set_header X-real-ip $remote_addr;
                proxy_set_header X-Forwarded-For $http_x_forwarded_for;
                add_header X-CDN-Cache $upstream_cache_status;
                proxy_hide_header Access-Control-Allow-Origin;
                add_header Access-Control-Allow-Origin *;
                proxy_cache cache_gbf;
                proxy_cache_key $host$uri$is_args$args;
                proxy_pass http://granbluefantasy;
        }
}
server{
        listen 80;
        server_name gbf.game-a.mbga.jp gbf.game-a1.mbga.jp gbf.game-a2.mbga.jp gbf.game-a3.mbga.jp gbf.game-a4.mbga.jp gbf.game-a5.mbga.jp;
        underscores_in_headers on;
        proxy_http_version 1.1;
        location / {
                proxy_set_header Host $host;
                proxy_set_header X-real-ip $remote_addr;
                proxy_set_header X-Forwarded-For $http_x_forwarded_for;
                add_header X-CDN-Cache $upstream_cache_status;
                proxy_hide_header Access-Control-Allow-Origin;
                add_header Access-Control-Allow-Origin *;
                proxy_cache cache_gbf;
                proxy_cache_key $host$uri$is_args$args;
                proxy_pass http://mbga;
        }
}
